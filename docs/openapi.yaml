openapi: 3.0.3
info:
  title: LIMS HL7 API
  description: Laboratory Information Management System with HL7 integration
  version: 1.0.0
  contact:
    name: PT ELGA TAMA
    email: support@elgatama.com

servers:
  - url: http://localhost:8322
    description: Development server
  - url: http://localhost:8322
    description: Production server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Error Response
    ErrorResponse:
      type: object
      properties:
        path:
          type: string
          example: "GET /api/v1/patient"
        status_code:
          type: integer
          example: 400
        error:
          type: string
          example: "Invalid request"
        extra_info:
          type: object
          additionalProperties: true

    # Pagination
    PaginationResponse:
      type: object
      properties:
        data:
          type: array
          items: {}
        total:
          type: integer
          example: 100

    # Patient Entities
    PatientSex:
      type: string
      enum: [M, F, U]
      example: M

    Patient:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        simrs_pid:
          type: string
          nullable: true
          example: "PID123456"
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        birthdate:
          type: string
          format: date-time
          example: "1990-01-01T00:00:00Z"
        sex:
          $ref: '#/components/schemas/PatientSex'
        phone_number:
          type: string
          example: "+628123456789"
        location:
          type: string
          example: "Jakarta"
        address:
          type: string
          example: "Jl. Sudirman No. 1"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        specimen_list:
          type: array
          items:
            $ref: '#/components/schemas/Specimen'

    PatientCreateRequest:
      type: object
      required: [first_name, birthdate, sex]
      properties:
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        birthdate:
          type: string
          format: date-time
          example: "1990-01-01T00:00:00Z"
        sex:
          $ref: '#/components/schemas/PatientSex'
        phone_number:
          type: string
          example: "+628123456789"
        location:
          type: string
          example: "Jakarta"
        address:
          type: string
          example: "Jl. Sudirman No. 1"

    # Work Order Entities
    WorkOrderStatus:
      type: string
      enum: [NEW, INCOMPLETE_SEND, PENDING, CANCELLED, SUCCESS]
      example: NEW

    WorkOrderCreateRequestTestType:
      type: object
      required: [test_type_id, test_type_code, specimen_type]
      properties:
        test_type_id:
          type: integer
          format: int64
          example: 1
        test_type_code:
          type: string
          example: "WBC"
        specimen_type:
          type: string
          example: "WBL"

    WorkOrderCreateRequest:
      type: object
      required: [patient_id, test_types, created_by]
      properties:
        patient_id:
          type: integer
          format: int64
          example: 1
        test_types:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/WorkOrderCreateRequestTestType'
        created_by:
          type: integer
          format: int64
          example: 1
        doctor_ids:
          type: array
          items:
            type: integer
            format: int64
          example: [1, 2]
        analyzer_ids:
          type: array
          items:
            type: integer
            format: int64
          example: [1]
        test_template_ids:
          type: array
          items:
            type: integer
            format: int64
          example: [1]
        barcode:
          type: string
          example: "WO2024001"
        barcode_simrs:
          type: string
          example: "SIMRS001"

    WorkOrder:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        status:
          $ref: '#/components/schemas/WorkOrderStatus'
        patient_id:
          type: integer
          format: int64
          example: 1
        barcode:
          type: string
          example: "WO2024001"
        barcode_simrs:
          type: string
          example: "SIMRS001"
        verified_status:
          type: string
          example: "PENDING"
        created_by:
          type: integer
          format: int64
          example: 1
        last_updated_by:
          type: integer
          format: int64
          example: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        patient:
          $ref: '#/components/schemas/Patient'
        specimen_list:
          type: array
          items:
            $ref: '#/components/schemas/Specimen'
        test_result:
          type: array
          items:
            $ref: '#/components/schemas/TestResult'
        total_request:
          type: integer
          format: int64
          example: 5
        total_result_filled:
          type: integer
          format: int64
          example: 3
        percent_complete:
          type: number
          format: float
          example: 60.0
        have_complete_data:
          type: boolean
          example: false

    WorkOrderRunRequest:
      type: object
      required: [device_id, work_order_ids]
      properties:
        device_id:
          type: integer
          format: int64
          example: 1
        work_order_ids:
          type: array
          items:
            type: integer
            format: int64
          example: [1, 2, 3]
        urgent:
          type: boolean
          example: false

    # Specimen Entities
    Specimen:
      type: object
      properties:
        id:
          type: integer
          example: 1
        patient_id:
          type: integer
          example: 1
        order_id:
          type: integer
          example: 1
        type:
          type: string
          example: "SER"
        collection_date:
          type: string
          example: "2024-01-01"
        received_date:
          type: string
          format: date-time
        source:
          type: string
          example: "Venous"
        condition:
          type: string
          example: "Good"
        method:
          type: string
          example: "Manual"
        comments:
          type: string
          example: "Normal collection"
        barcode:
          type: string
          example: "SPC001"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        observation_result:
          type: array
          items:
            $ref: '#/components/schemas/ObservationResult'
        observation_requests:
          type: array
          items:
            $ref: '#/components/schemas/ObservationRequest'
        work_order:
          $ref: '#/components/schemas/WorkOrder'
        patient:
          $ref: '#/components/schemas/Patient'

    # Observation Entities
    ObservationRequest:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        test_code:
          type: string
          example: "WBC"
        test_description:
          type: string
          example: "White Blood Cell Count"
        requested_date:
          type: string
          format: date-time
        result_status:
          type: string
          example: "PENDING"
        specimen_id:
          type: integer
          format: int64
          example: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ObservationResult:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        specimen_id:
          type: integer
          format: int64
          example: 1
        test_code:
          type: string
          example: "WBC"
        test_description:
          type: string
          example: "White Blood Cell Count"
        values:
          type: array
          items:
            type: string
          example: ["5.2"]
        unit:
          type: string
          example: "x10^9/L"
        reference_range:
          type: string
          example: "3.5-10.0"
        date:
          type: string
          format: date-time
        abnormal_flag:
          type: string
          example: "N"
        comments:
          type: string
          example: "Normal"
        picked:
          type: boolean
          example: false
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Test Type Entities
    TestType:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "White Blood Cell Count"
        code:
          type: string
          example: "WBC"
        alias_code:
          type: string
          example: "WBC"
        unit:
          type: string
          example: "x10^9/L"
        low_ref_range:
          type: number
          format: float
          example: 3.5
        high_ref_range:
          type: number
          format: float
          example: 10.0
        decimal:
          type: integer
          example: 2
        category:
          type: string
          example: "Hematology"
        sub_category:
          type: string
          example: "CBC"
        description:
          type: string
          example: "Complete Blood Count - White Blood Cell"
        is_calculated_test:
          type: boolean
          example: false
        types:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                example: "WBL"

    TestTypeFilter:
      type: object
      properties:
        categories:
          type: array
          items:
            type: string
          example: ["Hematology", "Chemistry"]
        sub_categories:
          type: array
          items:
            type: string
          example: ["CBC", "Lipid Profile"]

    # Result Entities
    AbnormalResult:
      type: integer
      enum: [0, 1, 2, 3]
      description: "0: Normal, 1: High, 2: Low, 3: No Data"
      example: 0

    TestResult:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        specimen_id:
          type: integer
          format: int64
          example: 1
        test_type_id:
          type: integer
          format: int64
          example: 1
        test:
          type: string
          example: "WBC"
        result:
          type: number
          format: float
          nullable: true
          example: 5.2
        formatted_result:
          type: number
          format: float
          nullable: true
          example: 5.20
        unit:
          type: string
          example: "x10^9/L"
        category:
          type: string
          example: "Hematology"
        specimen_type:
          type: string
          example: "WBL"
        abnormal:
          $ref: '#/components/schemas/AbnormalResult'
        reference_range:
          type: string
          example: "3.5 - 10.0"
        created_at:
          type: string
          format: date-time
        picked:
          type: boolean
          example: false
        test_type:
          $ref: '#/components/schemas/TestType'
        history:
          type: array
          items:
            $ref: '#/components/schemas/TestResult'

    ResultDetail:
      type: object
      properties:
        work_order:
          $ref: '#/components/schemas/WorkOrder'
        test_result:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/TestResult'
        prev_id:
          type: integer
          format: int64
          example: 0
        next_id:
          type: integer
          format: int64
          example: 2

    # Authentication
    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          example: "admin"
        password:
          type: string
          example: "password123"

    LoginResponse:
      type: object
      properties:
        admin:
          $ref: '#/components/schemas/Admin'
        access_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    # Admin/User Entities
    Admin:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        fullname:
          type: string
          example: "John Doe"
        username:
          type: string
          example: "johndoe"
        email:
          type: string
          format: email
          nullable: true
          example: "john@example.com"
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'

    Role:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Admin"
        description:
          type: string
          example: "System Administrator"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Config Entities
    Config:
      type: object
      properties:
        key:
          type: string
          example: "smtp_host"
        value:
          type: string
          example: "smtp.gmail.com"
        description:
          type: string
          example: "SMTP server host"

    # Unit Entities
    Unit:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "x10^9/L"
        description:
          type: string
          example: "10^9 per liter"

    # Device Entities
    Device:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Analyzer 1"
        type:
          type: string
          example: "HEMATOLOGY"
        host:
          type: string
          example: "192.168.1.100"
        port:
          type: integer
          example: 4001
        is_active:
          type: boolean
          example: true

  parameters:
    # Pagination parameters
    StartParam:
      name: _start
      in: query
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Start index for pagination
    EndParam:
      name: _end
      in: query
      schema:
        type: integer
        minimum: 1
        default: 10
      description: End index for pagination
    SortParam:
      name: _sort
      in: query
      schema:
        type: string
        default: id
      description: Field to sort by
    OrderParam:
      name: _order
      in: query
      schema:
        type: string
        enum: [ASC, DESC]
        default: ASC
      description: Sort order
    SearchParam:
      name: _search
      in: query
      schema:
        type: string
      description: Search term

security:
  - bearerAuth: []

paths:
  # Health Check
  /api/v1/ping:
    get:
      tags: [Health]
      summary: Health check ping
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            text/plain:
              schema:
                type: string
                example: "pong"

  # Authentication
  /api/v1/login:
    post:
      tags: [Authentication]
      summary: User login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/check-auth:
    get:
      tags: [Authentication]
      summary: Check authentication status
      responses:
        '200':
          description: Authentication valid
          content:
            text/plain:
              schema:
                type: string
                example: "pong"
        '401':
          description: Authentication invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Patients
  /api/v1/patient:
    get:
      tags: [Patients]
      summary: Get list of patients
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: birthdate
          in: query
          schema:
            type: string
            format: date-time
          description: Filter by birthdate
      responses:
        '200':
          description: List of patients
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of patients
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Patient'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags: [Patients]
      summary: Create a new patient
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientCreateRequest'
      responses:
        '201':
          description: Patient created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/patient/{id}:
    get:
      tags: [Patients]
      summary: Get patient by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Patient found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags: [Patients]
      summary: Update patient by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientCreateRequest'
      responses:
        '200':
          description: Patient updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags: [Patients]
      summary: Delete patient by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Patient deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patient'
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Specimens
  /api/v1/specimen:
    get:
      tags: [Specimens]
      summary: Get list of specimens
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: patient_id
          in: query
          schema:
            type: integer
            format: int64
          description: Filter by patient ID
        - name: work_order_id
          in: query
          schema:
            type: integer
            format: int64
          description: Filter by work order ID
      responses:
        '200':
          description: List of specimens
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of specimens
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Specimen'

  /api/v1/specimen/{id}:
    get:
      tags: [Specimens]
      summary: Get specimen by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Specimen found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Specimen'
        '404':
          description: Specimen not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Observation Requests
  /api/v1/observation-request:
    get:
      tags: [Observation Requests]
      summary: Get list of observation requests
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
      responses:
        '200':
          description: List of observation requests
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of observation requests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ObservationRequest'

  /api/v1/observation-request/{id}:
    get:
      tags: [Observation Requests]
      summary: Get observation request by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Observation request found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObservationRequest'
        '404':
          description: Observation request not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Work Orders
  /api/v1/work-order:
    get:
      tags: [Work Orders]
      summary: Get list of work orders
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: barcode_ids
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          description: Filter by barcode IDs
        - name: patient_id
          in: query
          schema:
            type: integer
            format: int64
          description: Filter by patient ID
        - name: patient_ids
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          description: Filter by patient IDs
        - name: specimen_ids
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          description: Filter by specimen IDs
      responses:
        '200':
          description: List of work orders
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of work orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkOrder'

    post:
      tags: [Work Orders]
      summary: Create a new work order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkOrderCreateRequest'
      responses:
        '201':
          description: Work order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkOrder'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/work-order/barcode:
    get:
      tags: [Work Orders]
      summary: Get work order barcode information
      responses:
        '200':
          description: Barcode information
          content:
            application/json:
              schema:
                type: object
                properties:
                  barcode:
                    type: string
                    example: "WO2024001"

  /api/v1/work-order/run:
    post:
      tags: [Work Orders]
      summary: Run work orders on a device
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkOrderRunRequest'
      responses:
        '200':
          description: Work orders started successfully
          content:
            text/event-stream:
              schema:
                type: string
                description: Server-sent events with progress updates
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/work-order/cancel:
    post:
      tags: [Work Orders]
      summary: Cancel work orders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                work_order_ids:
                  type: array
                  items:
                    type: integer
                    format: int64
      responses:
        '200':
          description: Work orders cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Work orders cancelled successfully"

  /api/v1/work-order/{id}:
    get:
      tags: [Work Orders]
      summary: Get work order by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Work order found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkOrder'
        '404':
          description: Work order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags: [Work Orders]
      summary: Update work order by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkOrderCreateRequest'
      responses:
        '200':
          description: Work order updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkOrder'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Work order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags: [Work Orders]
      summary: Delete work order by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Work order deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkOrder'
        '404':
          description: Work order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Test Types
  /api/v1/test-type:
    get:
      tags: [Test Types]
      summary: Get list of test types
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: code
          in: query
          schema:
            type: string
          description: Filter by test code
        - name: categories
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
          description: Filter by categories
        - name: subCategories
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
          description: Filter by sub-categories
      responses:
        '200':
          description: List of test types
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of test types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TestType'

    post:
      tags: [Test Types]
      summary: Create a new test type
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestType'
      responses:
        '201':
          description: Test type created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestType'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/test-type/filter:
    get:
      tags: [Test Types]
      summary: Get test type filters (categories and sub-categories)
      responses:
        '200':
          description: Test type filters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestTypeFilter'

  /api/v1/test-type/{id}:
    get:
      tags: [Test Types]
      summary: Get test type by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Test type found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestType'
        '404':
          description: Test type not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags: [Test Types]
      summary: Update test type by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestType'
      responses:
        '200':
          description: Test type updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestType'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Test type not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags: [Test Types]
      summary: Delete test type by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Test type deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestType'
        '404':
          description: Test type not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/test-type/code/{code}:
    get:
      tags: [Test Types]
      summary: Get test type by code
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Test type found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestType'
        '404':
          description: Test type not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/test-type/alias-code/{alias_code}:
    get:
      tags: [Test Types]
      summary: Get test type by alias code
      parameters:
        - name: alias_code
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Test type found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestType'
        '404':
          description: Test type not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Results
  /api/v1/result:
    get:
      tags: [Results]
      summary: Get list of results
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: barcode_ids
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          description: Filter by barcode IDs
        - name: patient_ids
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          description: Filter by patient IDs
        - name: doctor_ids
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: integer
              format: int64
          description: Filter by doctor IDs
        - name: has_result
          in: query
          schema:
            type: boolean
          description: Filter by whether has result
        - name: work_order_status
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
          description: Filter by work order status
      responses:
        '200':
          description: List of results
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Specimen'

  /api/v1/result/refresh:
    post:
      tags: [Results]
      summary: Refresh results data
      responses:
        '200':
          description: Results refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Results refreshed successfully"

  /api/v1/result/{work_order_id}:
    get:
      tags: [Results]
      summary: Get result by work order ID
      parameters:
        - name: work_order_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Result found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResultDetail'
        '404':
          description: Result not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/result/{work_order_id}/approve:
    post:
      tags: [Results]
      summary: Approve result for work order
      parameters:
        - name: work_order_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Result approved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Result approved successfully"

  /api/v1/result/{work_order_id}/reject:
    post:
      tags: [Results]
      summary: Reject result for work order
      parameters:
        - name: work_order_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Result rejected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Result rejected successfully"

  /api/v1/result/{work_order_id}/test:
    put:
      tags: [Results]
      summary: Add test result to work order
      parameters:
        - name: work_order_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestResult'
      responses:
        '200':
          description: Test result added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestResult'

  /api/v1/result/{work_order_id}/test/{test_result_id}/pick:
    put:
      tags: [Results]
      summary: Toggle pick status of test result
      parameters:
        - name: work_order_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: test_result_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Pick status toggled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestResult'

  /api/v1/result/{work_order_id}/test/{test_result_id}:
    delete:
      tags: [Results]
      summary: Delete test result
      parameters:
        - name: work_order_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: test_result_id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Test result deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Test result deleted successfully"

  /api/v1/result/a15/upload:
    post:
      tags: [Results]
      summary: Upload A15 file
      security: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "File uploaded successfully"

  # Configuration
  /api/v1/config:
    get:
      tags: [Configuration]
      summary: Get list of configurations
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
      responses:
        '200':
          description: List of configurations
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of configurations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Config'

  /api/v1/config/{key}:
    get:
      tags: [Configuration]
      summary: Get configuration by key
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Configuration found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Config'
        '404':
          description: Configuration not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags: [Configuration]
      summary: Update configuration by key
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Config'
      responses:
        '200':
          description: Configuration updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Config'
        '404':
          description: Configuration not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Units
  /api/v1/unit:
    get:
      tags: [Units]
      summary: Get list of units
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
      responses:
        '200':
          description: List of units
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of units
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Unit'

  # Users/Admins
  /api/v1/user:
    get:
      tags: [Users]
      summary: Get list of users
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: role
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
          description: Filter by role
      responses:
        '200':
          description: List of users
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Admin'

    post:
      tags: [Users]
      summary: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/Admin'
                - type: object
                  properties:
                    password:
                      type: string
                      example: "password123"
                  required: [password]
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Admin'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/user/{id}:
    get:
      tags: [Users]
      summary: Get user by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Admin'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags: [Users]
      summary: Update user by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Admin'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Admin'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags: [Users]
      summary: Delete user by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Admin'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Roles
  /api/v1/role:
    get:
      tags: [Roles]
      summary: Get list of roles
      parameters:
        - $ref: '#/components/parameters/StartParam'
        - $ref: '#/components/parameters/EndParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/OrderParam'
        - $ref: '#/components/parameters/SearchParam'
      responses:
        '200':
          description: List of roles
          headers:
            X-Total-Count:
              schema:
                type: integer
              description: Total number of roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'

  /api/v1/role/{id}:
    get:
      tags: [Roles]
      summary: Get role by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Role found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '404':
          description: Role not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Logs
  /api/v1/log/stream:
    get:
      tags: [Logs]
      summary: Stream logs in real-time
      security: []
      responses:
        '200':
          description: Log stream
          content:
            text/event-stream:
              schema:
                type: string
                description: Server-sent events with log data

  /api/v1/log/export:
    get:
      tags: [Logs]
      summary: Export logs
      responses:
        '200':
          description: Log export file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

tags:
  - name: Health
    description: Health check endpoints
  - name: Authentication
    description: Authentication and authorization
  - name: Patients
    description: Patient management
  - name: Specimens
    description: Specimen management
  - name: Observation Requests
    description: Laboratory observation requests
  - name: Work Orders
    description: Work order management
  - name: Test Types
    description: Test type configuration
  - name: Results
    description: Laboratory results management
  - name: Configuration
    description: System configuration
  - name: Units
    description: Unit of measurement management
  - name: Users
    description: User management
  - name: Roles
    description: Role management
  - name: Logs
    description: System logs and monitoring
